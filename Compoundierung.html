<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="HMI Dosierung">
    <title>MacromateXX Professional - Dosierung Status</title>
    <style>
        :root {
            --bg-gray: #d0d0d0;
            --text-black: #000000;
            --text-blue: #0066cc;
            --text-red: #cc0000;
            --active-green: #00cc00;
            --inactive-gray: #808080;
            --warning-orange: #ff8800;
            --magenta: #cc00cc;
            --header-gray: #e8e8e8;
            --sidebar-gray: #c0c0c0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: var(--bg-gray);
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 50px 1fr;
            width: 100%;
            height: 100%;
            gap: 2px;
        }
        
        /* Header */
        .header {
            grid-column: 1 / -1;
            background-color: var(--header-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 14px;
        }
        
        .header-left {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        
        .page-number {
            color: var(--text-red);
            font-weight: bold;
        }
        
        .header-right {
            display: flex;
            gap: 30px;
            align-items: center;
            font-size: 13px;
        }
        
        .datetime {
            display: flex;
            gap: 15px;
        }
        
        /* Main Area */
        .main-area {
            grid-column: 1;
            grid-row: 2;
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            overflow-y: auto;
        }
        
        /* Process Data Section */
        .process-data {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .data-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .data-field {
            background-color: #e0e0e0;
            padding: 6px 10px;
            border-radius: 3px;
        }
        
        .data-label {
            font-size: 11px;
            color: var(--text-black);
            margin-bottom: 2px;
        }
        
        .data-value {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-blue);
        }
        
        /* Dosing Section */
        .dosing-section {
            background-color: #e8e8e8;
            padding: 15px;
            border-radius: 5px;
            flex: 1;
            position: relative;
        }
        
        .dosing-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .dosing-title {
            font-size: 20px;
            font-weight: bold;
        }
        
        .recipe-info {
            color: var(--text-blue);
            font-size: 14px;
        }
        
        /* Dosing Table */
        .dosing-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            background-color: white;
        }
        
        .dosing-table th {
            background-color: #b0b0b0;
            padding: 8px 5px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #999;
            font-size: 11px;
        }
        
        .dosing-table td {
            padding: 8px 5px;
            text-align: center;
            border: 1px solid #ccc;
        }
        
        .dosing-table tr:nth-child(even) {
            background-color: #f5f5f5;
        }
        
        .material-name {
            color: var(--text-blue);
            font-weight: bold;
            text-align: left;
        }
        
        .value-blue {
            color: var(--text-blue);
            font-weight: bold;
        }
        
        .status-led {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin: 0 auto;
        }
        
        .led-green {
            background-color: var(--active-green);
            box-shadow: 0 0 5px var(--active-green);
        }
        
        .led-red {
            background-color: var(--text-red);
            box-shadow: 0 0 5px var(--text-red);
        }
        
        .led-gray {
            background-color: var(--inactive-gray);
        }
        
        /* Warning triangle */
        .warning-triangle {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 1.5s ease-in-out infinite;
            z-index: 1000;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }
        
        .warning-triangle.hidden {
            display: none;
        }
        
        .warning-triangle svg {
            width: 100%;
            height: 100%;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                opacity: 0.85;
                transform: translate(-50%, -50%) scale(1.08);
            }
        }
        
        /* Success Message Window */
        .success-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border: 8px solid #00cc00;
            padding: 30px 40px;
            border-radius: 10px;
            font-size: 14px;
            line-height: 1.6;
            text-align: justify;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            display: none;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            color: #333;
        }
        
        .success-message.show {
            display: block;
        }
        
        .success-message h2 {
            color: #00cc00;
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
            font-size: 24px;
        }
        
        .success-message h3 {
            margin-top: 0;
        }
        
        /* Login Overlay */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .login-overlay.hidden {
            display: none;
        }
        
        .login-box {
            background-color: white;
            padding: 40px 50px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            text-align: center;
            border: 5px solid transparent;
            transition: border-color 0.3s ease;
        }
        
        .login-box.success {
            border-color: #00cc00;
        }
        
        .login-overlay.fade-out {
            animation: fadeOut 1s ease forwards;
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }
        
        .login-box h2 {
            margin-top: 0;
            margin-bottom: 30px;
            font-size: 22px;
            color: #333;
            line-height: 1.4;
        }
        
        .color-keypad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .color-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: transform 0.1s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .color-btn:hover {
            transform: scale(1.05);
        }
        
        .color-btn:active {
            transform: scale(0.95);
        }
        
        /* Farben aus dem Bild */
        .color-green { background-color: #1abc9c; }
        .color-red { background-color: #e74c3c; }
        .color-pink { background-color: #ff4da6; }
        .color-brown { background-color: #5d4037; }
        .color-yellow { background-color: #f1e540; }
        .color-blue { background-color: #2962ff; }
        .color-white { background-color: #ffffff; border: 3px solid #ddd; }
        .color-orange { background-color: #ff8533; }
        .color-purple { background-color: #8e24aa; }
        .color-black { background-color: #000000; }
        
        .code-display {
            margin-bottom: 20px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .code-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #ccc;
            display: inline-block;
        }
        
        .code-dot.filled {
            border: none;
        }
        
        .login-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .login-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            font-weight: normal;
        }
        
        .login-btn.clear {
            background-color: #d0d0d0;
            color: #666;
        }
        
        .login-btn.clear:active {
            background-color: #b0b0b0;
        }
        
        .error-message {
            color: #e74c3c;
            margin-top: 15px;
            font-weight: bold;
            min-height: 20px;
        }
        
        .control-btn {
            padding: 4px 8px;
            border: 1px solid #999;
            border-radius: 3px;
            background-color: #e0e0e0;
            cursor: pointer;
            font-size: 16px;
        }
        
        .control-btn:active {
            background-color: #c0c0c0;
        }
        
        .total-row {
            background-color: #d0d0d0 !important;
            font-weight: bold;
        }
        
        /* Editable fields */
        .editable-field {
            background-color: white;
            border: 1px solid #999;
            padding: 6px;
            width: 100%;
            box-sizing: border-box;
            font-size: 12px;
            font-family: Arial, Helvetica, sans-serif;
        }
        
        .editable-field:focus {
            outline: 2px solid var(--text-blue);
            background-color: #ffffcc;
        }
        
        .name-input {
            color: var(--text-blue);
            font-weight: bold;
            text-align: left;
        }
        
        .percent-input {
            color: var(--text-blue);
            font-weight: bold;
            text-align: center;
        }
        
        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .dosing-table {
                font-size: 10px;
            }
            
            .dosing-table th,
            .dosing-table td {
                padding: 5px 3px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Overlay -->
    <div class="login-overlay" id="login-overlay">
        <div class="login-box">
            <h2>Zugriff auf Compoundierungsanlage verweigert.<br><span style="font-size: 20px; font-weight: normal;">Geben Sie den korrekten Farbcode ein.</span></h2>
            <div class="code-display" id="code-display">
                <div class="code-dot"></div>
                <div class="code-dot"></div>
                <div class="code-dot"></div>
                <div class="code-dot"></div>
            </div>
            <div class="color-keypad">
                <button class="color-btn color-green" data-color="green"></button>
                <button class="color-btn color-red" data-color="red"></button>
                <button class="color-btn color-pink" data-color="pink"></button>
                <button class="color-btn color-brown" data-color="brown"></button>
                <button class="color-btn color-yellow" data-color="yellow"></button>
                <button class="color-btn color-blue" data-color="blue"></button>
                <button class="color-btn color-white" data-color="white"></button>
                <button class="color-btn color-orange" data-color="orange"></button>
                <button class="color-btn color-purple" data-color="purple"></button>
                <button class="color-btn color-black" data-color="black"></button>
            </div>
            <div class="login-controls">
                <button class="login-btn clear" id="clear-btn">Löschen</button>
            </div>
            <div class="error-message" id="error-message"></div>
        </div>
    </div>
    
    <div class="container">
        <!-- Success Message -->
        <div class="success-message" id="success-message">
            <h2>Fehler behoben.</h2>
            <p style="text-align: center; font-size: 16px; font-weight: normal; margin-bottom: 20px;">
                Die Compoundierungsanlage läuft nun fehlerfrei. Die Produktion wird fortgesetzt.
            </p>
            <div style="width: 100%; height: 2px; background-color: #999; margin: 20px 0;"></div>
            <h3 style="text-align: center; color: #000000; margin-bottom: 15px;">Das Freimaurer Alphabet</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 20px;">
                <div style="text-align: center;">
                    <svg width="200" height="200" viewBox="0 0 200 200" style="border: 2px solid #333;">
                        <!-- First Grid (A-I) -->
                        <line x1="66" y1="0" x2="66" y2="200" stroke="#000000" stroke-width="3"/>
                        <line x1="133" y1="0" x2="133" y2="200" stroke="#000000" stroke-width="3"/>
                        <line x1="0" y1="66" x2="200" y2="66" stroke="#000000" stroke-width="3"/>
                        <line x1="0" y1="133" x2="200" y2="133" stroke="#000000" stroke-width="3"/>
                        
                        <text x="33" y="40" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">A</text>
                        <text x="100" y="40" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">B</text>
                        <text x="167" y="40" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">C</text>
                        
                        <text x="33" y="100" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">D</text>
                        <text x="100" y="100" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">E</text>
                        <text x="167" y="100" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">F</text>
                        
                        <text x="33" y="167" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">G</text>
                        <text x="100" y="167" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">H</text>
                        <text x="167" y="167" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">I</text>
                    </svg>
                    <p style="margin-top: 10px; font-weight: bold;">Buchstaben A-I</p>
                </div>
                
                <div style="text-align: center;">
                    <svg width="200" height="200" viewBox="0 0 200 200" style="border: 2px solid #333;">
                        <!-- X-shapes (J-M) without dots -->
                        <line x1="50" y1="50" x2="150" y2="150" stroke="#000000" stroke-width="3"/>
                        <line x1="150" y1="50" x2="50" y2="150" stroke="#000000" stroke-width="3"/>
                        
                        <text x="100" y="40" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">J</text>
                        <text x="160" y="100" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">K</text>
                        <text x="100" y="180" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">L</text>
                        <text x="40" y="100" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">M</text>
                    </svg>
                    <p style="margin-top: 10px; font-weight: bold;">Buchstaben J-M</p>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div style="text-align: center;">
                    <svg width="200" height="200" viewBox="0 0 200 200" style="border: 2px solid #333;">
                        <!-- Grid (N-U) with dots -->
                        <line x1="66" y1="0" x2="66" y2="200" stroke="#000000" stroke-width="3"/>
                        <line x1="133" y1="0" x2="133" y2="200" stroke="#000000" stroke-width="3"/>
                        <line x1="0" y1="66" x2="200" y2="66" stroke="#000000" stroke-width="3"/>
                        <line x1="0" y1="133" x2="200" y2="133" stroke="#000000" stroke-width="3"/>
                        
                        <text x="33" y="40" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">N</text>
                        <circle cx="33" cy="50" r="4" fill="#000"/>
                        <text x="100" y="40" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">O</text>
                        <circle cx="100" cy="50" r="4" fill="#000"/>
                        <text x="167" y="40" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">P</text>
                        <circle cx="167" cy="50" r="4" fill="#000"/>
                        
                        <text x="33" y="100" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">Q</text>
                        <circle cx="33" cy="110" r="4" fill="#000"/>
                        <text x="100" y="100" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">R</text>
                        <circle cx="100" cy="110" r="4" fill="#000"/>
                        <text x="167" y="100" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">S</text>
                        <circle cx="167" cy="110" r="4" fill="#000"/>
                        
                        <text x="33" y="167" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">T</text>
                        <circle cx="33" cy="177" r="4" fill="#000"/>
                        <text x="100" y="167" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">U</text>
                        <circle cx="100" cy="177" r="4" fill="#000"/>
                        <text x="167" y="167" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">V</text>
                        <circle cx="167" cy="177" r="4" fill="#000"/>
                    </svg>
                    <p style="margin-top: 10px; font-weight: bold;">Buchstaben N-V (mit Punkt)</p>
                </div>
                
                <div style="text-align: center;">
                    <svg width="200" height="200" viewBox="0 0 200 200" style="border: 2px solid #333;">
                        <!-- X-shapes (W-Z) with dots -->
                        <line x1="50" y1="50" x2="150" y2="150" stroke="#000000" stroke-width="3"/>
                        <line x1="150" y1="50" x2="50" y2="150" stroke="#000000" stroke-width="3"/>
                        
                        <text x="100" y="40" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">W</text>
                        <circle cx="100" cy="50" r="4" fill="#000"/>
                        <text x="160" y="100" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">X</text>
                        <circle cx="160" cy="110" r="4" fill="#000"/>
                        <text x="100" y="180" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">Y</text>
                        <circle cx="100" cy="150" r="4" fill="#000"/>
                        <text x="40" y="100" text-anchor="middle" font-size="24" fill="#cc0000" font-weight="bold">Z</text>
                        <circle cx="40" cy="110" r="4" fill="#000"/>
                    </svg>
                    <p style="margin-top: 10px; font-weight: bold;">Buchstaben W-Z (mit Punkt)</p>
                </div>
            </div>
            
            <p style="margin-top: 25px; text-align: center; font-size: 14px; color: #666;">
                <strong>Anleitung:</strong> Jeder Buchstabe wird durch die Form seiner Position im Raster dargestellt.<br>
                Punkte kennzeichnen die zweite Hälfte des Alphabets (N-V und W-Z).
            </p>
        </div>
        
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <span class="page-number">Seite: 44</span>
                <span>5532</span>
                <span>Enneatech ZSE60IMAXX</span>
            </div>
            <div class="header-right">
                <span>MacromateXX professional S7e</span>
                <div class="datetime">
                    <span id="date">06.08.2025</span>
                    <span id="time">14:17:26</span>
                </div>
            </div>
        </div>
        
        <!-- Main Area -->
        <div class="main-area">
            <!-- Process Data -->
            <div class="process-data">
                <div class="data-column">
                    <div class="data-field">
                        <div class="data-label">Schneckendrehzahl</div>
                        <div class="data-value">380 U/min</div>
                    </div>
                    <div class="data-field">
                        <div class="data-label">n Seitenbeschickung 1</div>
                        <div class="data-value">0 U/min</div>
                    </div>
                    <div class="data-field">
                        <div class="data-label">n Seitenbeschickung 2</div>
                        <div class="data-value">125 U/min</div>
                    </div>
                    <div class="data-field">
                        <div class="data-label">n Seitenentgasung</div>
                        <div class="data-value">0 U/min</div>
                    </div>
                </div>
                
                <div class="data-column">
                    <div class="data-field">
                        <div class="data-label">M Extruder</div>
                        <div class="data-value">62 %</div>
                    </div>
                    <div class="data-field">
                        <div class="data-label">Gesamtdurchsatz</div>
                        <div class="data-value" id="gesamtdurchsatz">0,0 kg/h</div>
                    </div>
                    <div class="data-field">
                        <div class="data-label">Vakuumdruck 1</div>
                        <div class="data-value">-770 mbar</div>
                    </div>
                </div>
                
                <div class="data-column">
                    <div class="data-field">
                        <div class="data-label">Massedruck 1</div>
                        <div class="data-value">41 bar</div>
                    </div>
                    <div class="data-field">
                        <div class="data-label">Massedruck 2</div>
                        <div class="data-value">27 bar</div>
                    </div>
                    <div class="data-field">
                        <div class="data-label">Massetemperatur 1</div>
                        <div class="data-value">309 °C</div>
                    </div>
                    <div class="data-field">
                        <div class="data-label">Massetemperatur 2</div>
                        <div class="data-value">311 °C</div>
                    </div>
                </div>
            </div>
            
            <!-- Dosing Section -->
            <div class="dosing-section">
                <!-- Warning Triangle -->
                <div class="warning-triangle" id="warning-triangle">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <!-- Outer black border -->
                        <path d="M256 32l236 448H20L256 32z" 
                              fill="none" 
                              stroke="#000000" 
                              stroke-width="28" 
                              stroke-linecap="round" 
                              stroke-linejoin="round"/>
                        
                        <!-- Red fill with rounded corners effect -->
                        <path d="M256 48l220 416H36L256 48z" 
                              fill="#FF3333" 
                              stroke="#FF5555" 
                              stroke-width="16" 
                              stroke-linecap="round" 
                              stroke-linejoin="round"/>
                        
                        <!-- Inner white/light area -->
                        <path d="M256 80l190 368H66L256 80z" 
                              fill="#F5F5F5" 
                              opacity="0.95"/>
                        
                        <!-- Exclamation mark - line -->
                        <rect x="238" y="180" width="36" height="140" 
                              rx="18" 
                              fill="#000000"/>
                        
                        <!-- Exclamation mark - dot -->
                        <circle cx="256" cy="360" r="20" 
                                fill="#000000"/>
                    </svg>
                </div>
                
                <div class="dosing-header">
                    <div class="dosing-title">
                        <span style="color: #0066cc;">SCHOLZ</span> Dosierung Status
                    </div>
                    <div class="recipe-info">aktuelles Rezept: 713009</div>
                </div>
                
                <table class="dosing-table">
                    <thead>
                        <tr>
                            <th>Nr.</th>
                            <th>Name</th>
                            <th>Soll %</th>
                            <th>Soll kg/h</th>
                            <th>Ist kg/h</th>
                            <th>Regelabw. %</th>
                            <th>Drehzahl %</th>
                            <th>Gewicht kg</th>
                            <th>Total kg</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-row="1">
                            <td>1</td>
                            <td class="material-name"><input type="text" class="editable-field name-input" data-row="1" data-field="name"></td>
                            <td class="value-blue"><input type="number" class="editable-field percent-input" data-row="1" data-field="percent" step="0.01" min="0" max="100"></td>
                            <td class="value-blue" data-col="soll-kgh"></td>
                            <td class="value-blue" data-col="ist-kgh"></td>
                            <td data-col="regelabw"></td>
                            <td class="value-blue" data-col="drehzahl"></td>
                            <td class="value-blue" data-col="gewicht"></td>
                            <td class="value-blue" data-col="total"></td>
                            <td><div class="status-led led-red" data-row="1"></div></td>
                        </tr>
                        <tr data-row="2">
                            <td>2</td>
                            <td class="material-name"><input type="text" class="editable-field name-input" data-row="2" data-field="name"></td>
                            <td class="value-blue"><input type="number" class="editable-field percent-input" data-row="2" data-field="percent" step="0.01" min="0" max="100"></td>
                            <td class="value-blue" data-col="soll-kgh"></td>
                            <td class="value-blue" data-col="ist-kgh"></td>
                            <td data-col="regelabw"></td>
                            <td class="value-blue" data-col="drehzahl"></td>
                            <td class="value-blue" data-col="gewicht"></td>
                            <td class="value-blue" data-col="total"></td>
                            <td><div class="status-led led-red" data-row="2"></div></td>
                        </tr>
                        <tr data-row="3">
                            <td>3</td>
                            <td class="material-name"><input type="text" class="editable-field name-input" data-row="3" data-field="name"></td>
                            <td class="value-blue"><input type="number" class="editable-field percent-input" data-row="3" data-field="percent" step="0.01" min="0" max="100"></td>
                            <td class="value-blue" data-col="soll-kgh"></td>
                            <td class="value-blue" data-col="ist-kgh"></td>
                            <td data-col="regelabw"></td>
                            <td class="value-blue" data-col="drehzahl"></td>
                            <td class="value-blue" data-col="gewicht"></td>
                            <td class="value-blue" data-col="total"></td>
                            <td><div class="status-led led-red" data-row="3"></div></td>
                        </tr>
                        <tr data-row="4">
                            <td>4</td>
                            <td class="material-name"><input type="text" class="editable-field name-input" data-row="4" data-field="name"></td>
                            <td class="value-blue"><input type="number" class="editable-field percent-input" data-row="4" data-field="percent" step="0.01" min="0" max="100"></td>
                            <td class="value-blue" data-col="soll-kgh"></td>
                            <td class="value-blue" data-col="ist-kgh"></td>
                            <td data-col="regelabw"></td>
                            <td class="value-blue" data-col="drehzahl"></td>
                            <td class="value-blue" data-col="gewicht"></td>
                            <td class="value-blue" data-col="total"></td>
                            <td><div class="status-led led-red" data-row="4"></div></td>
                        </tr>
                        <tr data-row="5">
                            <td>5</td>
                            <td class="material-name"><input type="text" class="editable-field name-input" data-row="5" data-field="name"></td>
                            <td class="value-blue"><input type="number" class="editable-field percent-input" data-row="5" data-field="percent" step="0.01" min="0" max="100"></td>
                            <td class="value-blue" data-col="soll-kgh"></td>
                            <td class="value-blue" data-col="ist-kgh"></td>
                            <td data-col="regelabw"></td>
                            <td class="value-blue" data-col="drehzahl"></td>
                            <td class="value-blue" data-col="gewicht"></td>
                            <td class="value-blue" data-col="total"></td>
                            <td><div class="status-led led-red" data-row="5"></div></td>
                        </tr>
                        <tr data-row="6">
                            <td>6</td>
                            <td class="material-name"><input type="text" class="editable-field name-input" data-row="6" data-field="name"></td>
                            <td class="value-blue"><input type="number" class="editable-field percent-input" data-row="6" data-field="percent" step="0.01" min="0" max="100"></td>
                            <td class="value-blue" data-col="soll-kgh"></td>
                            <td class="value-blue" data-col="ist-kgh"></td>
                            <td data-col="regelabw"></td>
                            <td class="value-blue" data-col="drehzahl"></td>
                            <td class="value-blue" data-col="gewicht"></td>
                            <td class="value-blue" data-col="total"></td>
                            <td><div class="status-led led-red" data-row="6"></div></td>
                        </tr>
                        <tr data-row="7">
                            <td>7</td>
                            <td class="material-name"><input type="text" class="editable-field name-input" data-row="7" data-field="name"></td>
                            <td class="value-blue"><input type="number" class="editable-field percent-input" data-row="7" data-field="percent" step="0.01" min="0" max="100"></td>
                            <td class="value-blue" data-col="soll-kgh"></td>
                            <td class="value-blue" data-col="ist-kgh"></td>
                            <td data-col="regelabw"></td>
                            <td class="value-blue" data-col="drehzahl"></td>
                            <td class="value-blue" data-col="gewicht"></td>
                            <td class="value-blue" data-col="total"></td>
                            <td><div class="status-led led-red" data-row="7"></div></td>
                        </tr>
                        <tr class="total-row">
                            <td colspan="2">Gesamt:</td>
                            <td id="total-soll-percent">0,0</td>
                            <td id="total-soll-kgh">0,00</td>
                            <td id="total-ist-kgh">0,00</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td id="total-total-kg">0,0</td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script>
        // Login System
        const correctCode = ['green', 'green', 'red', 'red']; // Code: grün grün rot rot
        let enteredCode = [];
        let isLoggedIn = false; // Track ob Login abgeschlossen ist
        
        function updateCodeDisplay() {
            const dots = document.querySelectorAll('.code-dot');
            dots.forEach((dot, index) => {
                if (index < enteredCode.length) {
                    dot.classList.add('filled');
                    // Setze die Farbe des Punkts auf die eingegebene Farbe
                    const colorClass = 'color-' + enteredCode[index];
                    dot.className = 'code-dot filled ' + colorClass;
                } else {
                    dot.className = 'code-dot';
                }
            });
        }
        
        function checkCode() {
            if (enteredCode.length === correctCode.length) {
                if (JSON.stringify(enteredCode) === JSON.stringify(correctCode)) {
                    // Code korrekt - grüner Rahmen und Fade-Out
                    document.querySelector('.login-box').classList.add('success');
                    document.getElementById('error-message').textContent = '';
                    
                    // Nach kurzer Verzögerung Fade-Out starten
                    setTimeout(() => {
                        document.getElementById('login-overlay').classList.add('fade-out');
                        
                        // Nach Animation das Overlay komplett verstecken und Alarm starten
                        setTimeout(() => {
                            document.getElementById('login-overlay').classList.add('hidden');
                            isLoggedIn = true; // Login ist jetzt abgeschlossen
                            // Alarm jetzt starten
                            startAlarm();
                        }, 1000);
                    }, 500);
                } else {
                    // Code falsch
                    document.getElementById('error-message').textContent = 'Falscher Code!';
                    setTimeout(() => {
                        enteredCode = [];
                        updateCodeDisplay();
                        document.getElementById('error-message').textContent = '';
                    }, 1500);
                }
            }
        }
        
        // Event Listener für Farb-Buttons
        document.querySelectorAll('.color-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                if (enteredCode.length < correctCode.length) {
                    const color = this.getAttribute('data-color');
                    enteredCode.push(color);
                    updateCodeDisplay();
                    checkCode();
                }
            });
        });
        
        // Löschen-Button
        document.getElementById('clear-btn').addEventListener('click', function() {
            enteredCode = [];
            updateCodeDisplay();
            document.getElementById('error-message').textContent = '';
        });
        
        // Update time every second
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('de-DE');
            const dateString = now.toLocaleDateString('de-DE');
            
            document.getElementById('time').textContent = timeString;
            document.getElementById('date').textContent = dateString;
        }
        
        updateTime();
        setInterval(updateTime, 1000);
        
        // Calculate totals from rows 1-7
        function calculateTotals() {
            const rows = document.querySelectorAll('.dosing-table tbody tr:not(.total-row)');
            
            let totalSollPercent = 0;
            let totalSollKgh = 0;
            let totalIstKgh = 0;
            let totalTotalKg = 0;
            
            rows.forEach(row => {
                // Get percent from input field
                const percentInput = row.querySelector('input[data-field="percent"]');
                const sollPercent = parseFloat(percentInput?.value || 0);
                
                const sollKgh = parseFloat(row.querySelector('[data-col="soll-kgh"]')?.textContent || 0);
                const istKgh = parseFloat(row.querySelector('[data-col="ist-kgh"]')?.textContent || 0);
                const totalKg = parseFloat(row.querySelector('[data-col="total"]')?.textContent || 0);
                
                totalSollPercent += sollPercent;
                totalSollKgh += sollKgh;
                totalIstKgh += istKgh;
                totalTotalKg += totalKg;
            });
            
            // Update total row
            document.getElementById('total-soll-percent').textContent = totalSollPercent.toFixed(1);
            document.getElementById('total-soll-kgh').textContent = totalSollKgh.toFixed(2);
            document.getElementById('total-ist-kgh').textContent = totalIstKgh.toFixed(2);
            document.getElementById('total-total-kg').textContent = totalTotalKg.toFixed(1);
            
            // Update Gesamtdurchsatz with value from total-ist-kgh
            document.getElementById('gesamtdurchsatz').textContent = totalIstKgh.toFixed(1) + ' kg/h';
        }
        
        // Initial calculation
        calculateTotals();
        
        // Alarm sound variables
        let alarmInterval = null;
        let isAlarmPlaying = false;
        let audioContext = null; // Wiederverwendbarer AudioContext
        
        // Initialize AudioContext once
        function getAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }
        
        // Function to play alarm sound (honking/trötend)
        function playAlarmSound() {
            const ctx = getAudioContext();
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);
            
            // Alarm sound - single low frequency
            oscillator.type = 'square'; // Square wave for harsher alarm sound
            oscillator.frequency.setValueAtTime(300, ctx.currentTime); // Single deep tone (300 Hz)
            
            // Volume envelope - longer duration, quieter than ping sound
            gainNode.gain.setValueAtTime(0, ctx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.15, ctx.currentTime + 0.05); // Quieter (0.15 vs 1.0)
            gainNode.gain.setValueAtTime(0.15, ctx.currentTime + 0.85);
            gainNode.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.9);
            
            oscillator.start(ctx.currentTime);
            oscillator.stop(ctx.currentTime + 0.95);
            
            // Cleanup nach dem Sound
            oscillator.onended = () => {
                oscillator.disconnect();
                gainNode.disconnect();
            };
        }
        
        // Function to start continuous alarm
        function startAlarm() {
            console.log('startAlarm called, isAlarmPlaying:', isAlarmPlaying);
            
            if (isAlarmPlaying) {
                console.log('Alarm already playing, returning');
                return; // Bereits am Laufen
            }
            
            // Stoppe zuerst alle existierenden Intervalle zur Sicherheit
            if (alarmInterval) {
                console.log('Clearing existing interval');
                clearInterval(alarmInterval);
                alarmInterval = null;
            }
            
            isAlarmPlaying = true;
            console.log('Starting alarm...');
            playAlarmSound(); // Play immediately
            
            // Repeat every 2 seconds
            alarmInterval = setInterval(() => {
                console.log('Playing alarm sound from interval');
                playAlarmSound();
            }, 2000);
        }
        
        // Function to stop alarm
        function stopAlarm() {
            console.log('stopAlarm called');
            if (alarmInterval) {
                clearInterval(alarmInterval);
                alarmInterval = null;
            }
            isAlarmPlaying = false;
        }
        
        // Start alarm on page load
        // startAlarm(); // Entfernt - Alarm startet erst nach Login
        
        // Predefined values for rows
        const predefinedValues = {
            1: { name: 'richtig', percent: 61.0 },
            2: { name: 'richtig', percent: 1.5 },
            3: { name: 'richtig', percent: 6.5 },
            4: { name: 'richtig', percent: 2.0 },
            5: { name: 'richtig', percent: 11.0 },
            6: { name: 'richtig', percent: 18.0 }
        };
        
        // Initial values (wrong values at start)
        const initialValues = {
            1: { name: 'falsch', percent: 61.0 },
            2: { name: 'falsch', percent: 1.5 },
            3: { name: 'falsch', percent: 6.5 },
            4: { name: 'falsch', percent: 2.0 },
            5: { name: 'falsch', percent: 11.0 },
            6: { name: 'falsch', percent: 18.0 }
        };
        
        // Set initial values on page load
        function setInitialValues() {
            Object.keys(initialValues).forEach(rowNum => {
                const row = document.querySelector(`tr[data-row="${rowNum}"]`);
                if (row) {
                    const nameInput = row.querySelector('input[data-field="name"]');
                    const percentInput = row.querySelector('input[data-field="percent"]');
                    
                    if (nameInput && percentInput) {
                        nameInput.value = initialValues[rowNum].name;
                        percentInput.value = initialValues[rowNum].percent;
                        
                        // Trigger calculations
                        calculateRowValues(rowNum);
                    }
                }
            });
        }
        
        // Call after DOM is ready
        setTimeout(setInitialValues, 100);
        
        // Function to check if a row matches its predefined values
        function checkRowStatus(rowNumber) {
            const row = document.querySelector(`tr[data-row="${rowNumber}"]`);
            if (!row) return false;
            
            const nameInput = row.querySelector('input[data-field="name"]');
            const percentInput = row.querySelector('input[data-field="percent"]');
            const statusLed = row.querySelector('.status-led');
            
            const predefined = predefinedValues[rowNumber];
            
            if (!predefined) {
                // No predefined values for this row - keep red
                return false;
            }
            
            const nameMatch = nameInput.value.trim() === predefined.name;
            const percentMatch = Math.abs(parseFloat(percentInput.value || 0) - predefined.percent) < 0.01;
            
            // Check previous state
            const wasGreen = statusLed.classList.contains('led-green');
            
            if (nameMatch && percentMatch) {
                // Values match - turn green
                statusLed.className = 'status-led led-green';
                
                // Play ping sound if it just turned green (wasn't green before)
                if (!wasGreen) {
                    playPingSound();
                }
                
                return true;
            } else {
                // Values don't match - turn red
                statusLed.className = 'status-led led-red';
                return false;
            }
        }
        
        // Function to play ping sound
        function playPingSound() {
            // Create AudioContext
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Create oscillator (tone generator)
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            // Connect nodes
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // Configure ping sound - 1000 Hz
            oscillator.frequency.setValueAtTime(1000, audioContext.currentTime); // 1000 Hz
            oscillator.type = 'sine'; // Sine wave for smooth sound
            
            // Envelope (volume over time) - maximum volume
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(1.0, audioContext.currentTime + 0.02); // Maximum volume (1.0)
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6); // Longer decay
            
            // Start and stop - longer duration
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.6);
        }
        
        // Function to play success sound (Pingeling - aufsteigende Töne)
        function playSuccessSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Erster Ton (C)
            const osc1 = audioContext.createOscillator();
            const gain1 = audioContext.createGain();
            osc1.connect(gain1);
            gain1.connect(audioContext.destination);
            osc1.frequency.setValueAtTime(523, audioContext.currentTime); // C5
            osc1.type = 'sine';
            gain1.gain.setValueAtTime(0, audioContext.currentTime);
            gain1.gain.linearRampToValueAtTime(0.8, audioContext.currentTime + 0.02);
            gain1.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            osc1.start(audioContext.currentTime);
            osc1.stop(audioContext.currentTime + 0.3);
            
            // Zweiter Ton (E)
            const osc2 = audioContext.createOscillator();
            const gain2 = audioContext.createGain();
            osc2.connect(gain2);
            gain2.connect(audioContext.destination);
            osc2.frequency.setValueAtTime(659, audioContext.currentTime + 0.15); // E5
            osc2.type = 'sine';
            gain2.gain.setValueAtTime(0, audioContext.currentTime + 0.15);
            gain2.gain.linearRampToValueAtTime(0.8, audioContext.currentTime + 0.17);
            gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.45);
            osc2.start(audioContext.currentTime + 0.15);
            osc2.stop(audioContext.currentTime + 0.45);
            
            // Dritter Ton (G)
            const osc3 = audioContext.createOscillator();
            const gain3 = audioContext.createGain();
            osc3.connect(gain3);
            gain3.connect(audioContext.destination);
            osc3.frequency.setValueAtTime(784, audioContext.currentTime + 0.3); // G5
            osc3.type = 'sine';
            gain3.gain.setValueAtTime(0, audioContext.currentTime + 0.3);
            gain3.gain.linearRampToValueAtTime(1.0, audioContext.currentTime + 0.32);
            gain3.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
            osc3.start(audioContext.currentTime + 0.3);
            osc3.stop(audioContext.currentTime + 0.8);
        }
        
        // Function to update warning triangle visibility
        function updateWarningTriangle() {
            const allGreen = Object.keys(predefinedValues).every(rowNum => checkRowStatus(rowNum));
            const warningTriangle = document.getElementById('warning-triangle');
            const successMessage = document.getElementById('success-message');
            
            if (allGreen) {
                warningTriangle.classList.add('hidden');
                stopAlarm(); // Stop alarm when all values are correct
                
                // Erfolgston abspielen
                playSuccessSound();
                
                // Success-Message mit Verzögerung anzeigen
                setTimeout(() => {
                    successMessage.classList.add('show');
                    
                    // Sende Nachricht an Parent-Window
                    window.parent.postMessage({ type: 'COMPOUNDIERUNG_SUCCESS' }, '*');
                    console.log('Success message sent to parent');
                }, 800); // 800ms Verzögerung
            } else {
                warningTriangle.classList.remove('hidden');
                successMessage.classList.remove('show'); // Hide success message
                // Nur Alarm starten wenn bereits eingeloggt
                if (!isAlarmPlaying && isLoggedIn) {
                    startAlarm(); // Start alarm if not already playing
                }
            }
        }
        
        // Initial check
        updateWarningTriangle();
        
        // Function to calculate dependent values for a row
        function calculateRowValues(rowNumber) {
            const row = document.querySelector(`tr[data-row="${rowNumber}"]`);
            if (!row) return;
            
            const percentInput = row.querySelector('input[data-field="percent"]');
            const percent = parseFloat(percentInput?.value || 0);
            
            // Use a base throughput value (e.g., 500 kg/h) or get from total-soll-kgh
            // This should be a target value, not dependent on current values
            const baseThroughput = 500; // This can be made configurable
            
            // Calculate Soll kg/h based on percent of base throughput
            const sollKgh = (percent / 100) * baseThroughput;
            
            // For now, set Ist kg/h equal to Soll kg/h with small variation
            const variation = (Math.random() - 0.5) * 0.4; // ±0.2%
            const istKgh = sollKgh * (1 + variation / 100);
            
            // Calculate deviation
            const regelabw = sollKgh > 0 ? ((istKgh - sollKgh) / sollKgh * 100) : 0;
            
            // Example values for other fields (these can be adjusted based on your logic)
            const drehzahl = percent > 0 ? Math.round(20 + percent * 0.5) : 0;
            const gewicht = istKgh > 0 ? (istKgh * 0.17).toFixed(3) : '';
            const total = istKgh > 0 ? (istKgh * 0.116).toFixed(1) : '';
            
            // Update the row cells
            row.querySelector('[data-col="soll-kgh"]').textContent = percent > 0 ? sollKgh.toFixed(2) : '';
            row.querySelector('[data-col="ist-kgh"]').textContent = percent > 0 ? istKgh.toFixed(2) : '';
            row.querySelector('[data-col="regelabw"]').textContent = percent > 0 ? (regelabw >= 0 ? '+' : '') + regelabw.toFixed(1) : '';
            row.querySelector('[data-col="drehzahl"]').textContent = percent > 0 ? drehzahl : '';
            row.querySelector('[data-col="gewicht"]').textContent = gewicht;
            row.querySelector('[data-col="total"]').textContent = total;
            
            // Recalculate totals
            calculateTotals();
        }
        
        // Add event listeners to all input fields
        document.querySelectorAll('input[data-field="percent"]').forEach(input => {
            input.addEventListener('input', function() {
                const rowNumber = this.getAttribute('data-row');
                calculateRowValues(rowNumber);
                checkRowStatus(rowNumber);
                updateWarningTriangle();
            });
        });
        
        document.querySelectorAll('input[data-field="name"]').forEach(input => {
            input.addEventListener('input', function() {
                const rowNumber = this.getAttribute('data-row');
                checkRowStatus(rowNumber);
                updateWarningTriangle();
            });
        });
        
        // Prevent zoom on double-tap for iOS
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // Add click handlers for interactive elements
        document.querySelectorAll('.control-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                // Visual feedback
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = 'scale(1)';
                }, 100);
            });
        });
    </script>
    
    <script>
    // Listen for mute/unmute messages from parent window
    window.addEventListener('message', function(event) {
        if (event.data.type === 'MUTE_AUDIO') {
            console.log('Received MUTE_AUDIO message');
            // Mute all audio and video elements
            const audioElements = document.querySelectorAll('audio, video');
            audioElements.forEach(audio => {
                audio.muted = true;
            });
            
            // Suspend Web Audio API context
            if (audioContext && audioContext.state === 'running') {
                audioContext.suspend().then(() => {
                    console.log('AudioContext suspended');
                });
            }
            
        } else if (event.data.type === 'UNMUTE_AUDIO') {
            console.log('Received UNMUTE_AUDIO message');
            // Unmute all audio and video elements
            const audioElements = document.querySelectorAll('audio, video');
            audioElements.forEach(audio => {
                audio.muted = false;
            });
            
            // Resume Web Audio API context
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    console.log('AudioContext resumed');
                });
            }
        }
    });

    // Listen for mute/unmute messages from parent window
    let isMuted = false;
    
    window.addEventListener('message', function(event) {
        if (event.data.type === 'MUTE_AUDIO') {
            console.log('Muting audio from parent');
            isMuted = true;
            
            // Suspend the AudioContext to stop all sounds
            if (audioContext && audioContext.state === 'running') {
                audioContext.suspend().then(() => {
                    console.log('AudioContext suspended (muted)');
                });
            }
            
        } else if (event.data.type === 'UNMUTE_AUDIO') {
            console.log('Unmuting audio from parent');
            isMuted = false;
            
            // Resume the AudioContext
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    console.log('AudioContext resumed (unmuted)');
                });
            }
        }
    });
    </script>
</body>
</html>
